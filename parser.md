Basically it should be a statemachine


Each token is part of 
Each state has possible different states that get inoked by a regex. 
Sometimes we need to follow a direction in a graph for a while before we can be sure that it was the right way.